# セキュリティ詳細設計

## 5.1 認証詳細設計

### 認証方式
- **管理者認証**: microCMSの管理画面で実施（フロントエンド側では不要）
- **API認証**: microCMS APIキーを使用（環境変数で管理）
- **読者認証**: 不要（公開ブログ）

### 認証フロー

#### API認証フロー
```
[Next.jsビルド時]
    ↓
[環境変数からAPIキー取得]
    ↓
[microCMS APIにリクエスト]
    ├─→ [X-API-KEYヘッダーにAPIキーを設定]
    └─→ [認証成功]
    ↓
[データ取得]
```

### セッション管理
- フロントエンド側ではセッション管理は不要（公開ブログ）
- microCMSの管理画面でのセッション管理はmicroCMS側で実施

### パスワードポリシー
- フロントエンド側ではパスワード管理は不要
- microCMSの管理画面でのパスワードポリシーはmicroCMS側で管理

## 5.2 認可詳細設計

### 認可方式
- **管理者**: microCMSの管理画面で認可（フロントエンド側では不要）
- **読者**: 認可不要（すべてのコンテンツが公開）

### ロール定義
- **管理者**: microCMSの管理画面で記事を管理
- **読者**: すべての公開記事を閲覧可能

### 権限マトリクス

| 機能 | 管理者 | 読者 |
|------|--------|------|
| 記事閲覧 | ○ | ○ |
| 記事作成 | ○（microCMS管理画面） | × |
| 記事編集 | ○（microCMS管理画面） | × |
| 記事削除 | ○（microCMS管理画面） | × |

## 5.3 データ暗号化

### 暗号化対象
- **APIキー**: 環境変数で管理（平文で保存しない）
- **通信データ**: HTTPSで暗号化（自動）

### 暗号化方式
- **通信暗号化**: TLS 1.2以上（HTTPS）
- **APIキー**: 環境変数で管理（暗号化は不要、Gitにコミットしない）

### 鍵管理
- **APIキー**: 環境変数（`.env.local`）で管理
- **Vercel**: Vercelの環境変数設定で管理
- **Git**: `.env.local`を`.gitignore`に追加してコミットしない

## 5.4 セキュリティ対策詳細

### XSS（Cross-Site Scripting）対策

#### 対策内容
- Reactのデフォルト機能（自動エスケープ）を活用
- マークダウン解析時にサニタイズを実施

#### 対象
- すべてのユーザー入力
- マークダウンコンテンツ

#### 実装方法
- ReactのJSXで自動エスケープ
- react-markdownのオプションでサニタイズを有効化
- DOMPurifyなどのライブラリを使用（必要に応じて）

### CSRF（Cross-Site Request Forgery）対策

#### 対策内容
- 読み取り専用APIのため、基本的に不要
- 必要に応じてCSRFトークンを実装

#### 対象
- 書き込み操作（現在は不要）

#### 実装方法
- 現在は実装不要（読み取り専用）

### SQLインジェクション対策

#### 対策内容
- microCMS APIを使用するため、直接SQLを実行しない
- APIパラメータのバリデーションを実施

#### 対象
- APIリクエストパラメータ

#### 実装方法
- microCMS SDKを使用（パラメータは自動的にエスケープ）
- 入力値のバリデーションを実施

### クリックジャッキング対策

#### 対策内容
- X-Frame-Optionsヘッダーを設定
- Content-Security-Policyヘッダーを設定

#### 対象
- すべてのページ

#### 実装方法
- Vercelの設定またはNext.jsのミドルウェアで設定
- `next.config.js`でセキュリティヘッダーを設定

### セキュリティヘッダー設定

#### 設定内容
- `X-Frame-Options: DENY` - クリックジャッキング対策
- `X-Content-Type-Options: nosniff` - MIMEタイプスニッフィング対策
- `Referrer-Policy: strict-origin-when-cross-origin` - リファラー情報の制御
- `Content-Security-Policy` - CSP設定（必要に応じて）

#### 対象
- すべてのページ

#### 実装方法
- `next.config.js`の`headers`オプションで設定

### 環境変数の管理

#### 対策内容
- APIキーを環境変数で管理
- `.env.local`を`.gitignore`に追加

#### 対象
- `MICROCMS_API_KEY`
- `MICROCMS_SERVICE_DOMAIN`

#### 実装方法
- `.env.local`ファイルを作成
- `.gitignore`に`.env.local`を追加
- Vercelの環境変数設定で本番環境の値を設定


