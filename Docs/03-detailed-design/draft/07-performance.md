# パフォーマンス詳細設計

## 7.1 パフォーマンス対策詳細

### SSG（Static Site Generation）による高速化

#### 対象処理
- すべてのページの生成

#### 対策内容
- ビルド時に静的HTMLを生成
- CDN経由で配信

#### 期待効果
- ページ読み込み速度: 1秒以内
- サーバー負荷: 最小限

#### 実装方法
- Next.jsの`generateStaticParams`を使用
- ビルド時にmicroCMSからデータを取得して静的HTMLを生成

### 画像最適化

#### 対象処理
- アイキャッチ画像の表示
- 記事内画像の表示

#### 対策内容
- Next.jsのImageコンポーネントを使用
- 画像の遅延読み込み（lazy loading）
- WebP形式への自動変換
- レスポンシブ画像の生成

#### 期待効果
- 画像読み込み時間: 50%削減
- ページサイズ: 30%削減

#### 実装方法
- `next/image`コンポーネントを使用
- `loading="lazy"`属性を設定
- `srcSet`でレスポンシブ画像を生成

### コード分割

#### 対象処理
- JavaScriptバンドルの分割

#### 対策内容
- Next.jsの自動コード分割機能を活用
- ページ単位でJavaScriptを分割
- 動的インポートを使用

#### 期待効果
- 初期読み込み時間: 40%削減
- バンドルサイズ: 50%削減

#### 実装方法
- Next.jsの自動コード分割を活用
- `next/dynamic`で動的インポートを使用（必要に応じて）

### フォント最適化

#### 対象処理
- Webフォントの読み込み

#### 対策内容
- フォントの最適化（next/font）
- フォントのプリロード
- フォールバックフォントの設定

#### 期待効果
- フォント読み込み時間: 30%削減
- FOUT（Flash of Unstyled Text）の防止

#### 実装方法
- `next/font`を使用してフォントを最適化
- `font-display: swap`を設定

### マークダウン解析の最適化

#### 対象処理
- マークダウンコンテンツの解析

#### 対策内容
- ビルド時にマークダウンをHTMLに変換
- クライアントサイドでの解析を最小化

#### 期待効果
- マークダウン解析時間: 80%削減
- クライアントサイドの負荷: 最小限

#### 実装方法
- ビルド時にマークダウンをHTMLに変換
- 生成されたHTMLを静的ファイルとして保存

## 7.2 キャッシュ詳細設計

### キャッシュ戦略

#### ビルド時キャッシュ
- Next.jsのビルドキャッシュを活用
- 変更のないページは再生成しない

#### 実行時キャッシュ
- VercelのCDNキャッシュ（自動）
- ブラウザキャッシュ（Cache-Controlヘッダー）

### キャッシュ対象

#### 静的アセット
- HTMLファイル
- CSSファイル
- JavaScriptファイル
- 画像ファイル

#### キャッシュ有効期限
- **HTML**: 1時間（ISRを使用する場合）
- **CSS/JavaScript**: 1年（ファイル名にハッシュを含める）
- **画像**: 1年（最適化済み画像）

### キャッシュ無効化

#### 自動無効化
- ビルド時にファイル名にハッシュを含める
- 変更があったファイルのみ再生成

#### 手動無効化
- Vercelのキャッシュクリア機能を使用
- 必要に応じて手動でキャッシュをクリア

### ISR（Incremental Static Regeneration）

#### 実装方針
- 必要に応じてISRを活用
- 記事更新時に自動的にページを再生成

#### 再生成間隔
- デフォルト: 1時間
- 必要に応じて調整可能

#### Webhook連携
- microCMSのWebhook機能を使用
- 記事更新時にVercelの再ビルドをトリガー

## 7.3 データベース最適化

### クエリ最適化

#### microCMS APIの最適化
- 必要なフィールドのみを取得（`fields`パラメータ）
- ページネーションを適切に使用
- 不要なデータを取得しない

#### 実装方法
- microCMS SDKの`fields`オプションを使用
- `limit`と`offset`でページネーションを実装

### インデックス最適化

#### microCMS側のインデックス
- publishedAt: 降順インデックス（記事一覧のソート用）
- category: 通常インデックス（カテゴリフィルタ用）
- slug: ユニークインデックス（URL生成用）

#### 実装方法
- microCMSの管理画面でインデックスを設定
- 必要に応じてカスタムインデックスを追加

### 接続プール設定

#### microCMS API接続
- ビルド時のみAPI接続
- 実行時はAPI接続不要（SSGのため）

#### 実装方法
- ビルド時にAPI接続を確立
- 接続プールは不要（ビルド時のみ接続）

## 7.4 パフォーマンス監視

### 監視項目
- **ページ読み込み速度**: Lighthouseスコア
- **First Contentful Paint (FCP)**: 1.8秒以内
- **Largest Contentful Paint (LCP)**: 2.5秒以内
- **Time to Interactive (TTI)**: 3.8秒以内
- **Cumulative Layout Shift (CLS)**: 0.1以下

### 監視方法
- **Vercel Analytics**: パフォーマンスメトリクスを自動収集
- **Google Lighthouse**: 定期的にパフォーマンスを測定
- **Web Vitals**: リアルユーザーメトリクスを収集

### 最適化目標
- **Lighthouseスコア**: 90点以上
- **Core Web Vitals**: すべての指標で「良好」を達成


